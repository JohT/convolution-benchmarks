{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "bar chart that shows the benchmark results",
    "data": {
        "url": "../build/benchmark/benchmark-report.json",
        "format": {
            "type": "json",
            "property": "Catch2TestRun.TestCase[0].BenchmarkResults"
        }
    },
    "transform": [
        {
            "calculate": "toNumber(split(split(datum.$.name, ' (kernel ')[1],')')[0])",
            "as": "ConvolutionKernelSize"
        },
        {
            "calculate": "replace(datum.$.name, ' (kernel ' + datum.ConvolutionKernelSize + ')', '')",
            "as": "Algorithm"
        },
        {
            "calculate": "round(toNumber(datum.mean[0].$.value) / 1000)",
            "as": "MeanExecutionTime"
        }
    ],
    "facet": {
        "column": {
            "field": "ConvolutionKernelSize",
            "title": "Convolution Benchmarks",
            "header": {
                "titleFontSize": 16,
                "labelFontSize": 14,
                "labelExpr": "'kernel size ' + datum.value"
            }
        }
    },
    "resolve": {
        "scale": {
            "x": "independent",
            "y": "independent"
        }
    },
    "spec": {
        "height": {
            "step": 20
        },
        "encoding": {
            "y": {
                "field": "Algorithm",
                "title": "algorithm",
                "type": "nominal",
                "sort": "x",
                "axis": {
                    "labelFontSize": 10,
                    "labelLimit": 300,
                    "labelOverlap": false,
                    "titlePadding": 120
                }
            },
            "x": {
                "field": "MeanExecutionTime",
                "title": "mean execution time in Âµs",
                "type": "quantitative",
                "stack": null
            }
        },
        "layer": [
            {
                "mark": {
                    "type": "bar",
                    "cornerRadiusEnd": 4,
                    "height": {
                        "band": 0.90
                    }
                }
            },
            {
                "mark": {
                    "type": "text",
                    "style": "label",
                    "align": "left",
                    "baseline": "middle",
                    "dx": 4,
                    "size": 9
                },
                "encoding": {
                    "text": {
                        "field": "MeanExecutionTime",
                        "type": "quantitative"
                    }
                }
            }
        ]
    }
}